\section{Clock service}
The \textit{ClockService}-class is taking care of everything that is happening with the clock itself.

\subsection{Clock increment}
The most used method in the class is the \textit{increaseClock}-method. As the name describes it takes care of the increasing of the clock for the user. The approach for this is that the user object is provided in the method call. The  method is increasing the value by one for the user that's provided. \Cref{code:vecClockInc} show's this code.

\begin{listing}
\caption{Clock increasing}
\label{code:vecClockInc}
\begin{minted}[frame=lines, breaklines]{java}
user.vectorClock.put(user.getUsername(), user.vectorClock.get(user.getUsername()) + 1);
\end{minted}
\end{listing}

\bigskip

Since the clock should increase only when a chat message is sent this needs to be controlled. This is done directly in the \textit{sendBroadcast}-method in the \textit{GroupCommunication}-class.

If the message type is \textbf{ChatMessage} then the clock will be increased for the client that sends the message. \Cref{fig:msgType} show's a simple flow diagram over this process.

\fig{H}{Message type decision}{msgType}{0.5}{fig/msgTypeFlow.png}

\bigskip

The remote clients that's connected will not get the updated clock from the local client directly. They will get the updated clock only when they send out a message to themselves.

\subsection{Message ordering}
In the vector clock we need to check if the incoming messages is in order. If it's in order it should be displayed directly. On the other hand, if the message is \textbf{ahead} of time the message is being stored. The message will be displayed when the ''time has come'' for the message. If the message is \textbf{behind} of the other messages this message will not be displayed at all. The message will not be inserted in the ''queue list'' but will instead be discarded and lost forever. In the flow chart presented in \cref{fig:orderingFlowChart} below shows this.

\fig{H}{Message ordering flow chart}{orderingFlowChart}{0.8}{fig/orderingFlowFig.png}

